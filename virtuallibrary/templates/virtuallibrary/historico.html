{% load static %}

<html>
<head>
    <meta charset="UTF-8">
    <title>HistÃ³rico de EmprÃ©stimos - Virtual Library</title>
    <link rel="stylesheet" href="{% static 'css/history.css'Â %}">
</head>

<body>
    <aside class="sidebar">
        <div class="logo-container">
            <i class="fas fa-book"></i>
            <div class="welcome">HistÃ³rico<br><strong>{{ user.username }}</strong></div>
        </div>

        <nav>
            <ul class="nav-menu">


                <li><a href="{% url 'virtuallibrary:home' %}">Home</a></li>
                <li><a href="{% url 'virtuallibrary:profile' %}">Meu Perfil</a></li>
                <li><a href="{% url 'virtuallibrary:book_list' %}">Descubra</a></li>
                <li><a href="{% url 'virtuallibrary:historico' %}" class="active">HistÃ³rico</a></li>

                <!-- BotÃ£o apenas para bibliotecÃ¡rios -->
                {% if user.groups.all %}
                    {% for group in user.groups.all %}
                        {% if group.name == 'BibliotecÃ¡rio' %}
                                <li><a href="{% url 'virtuallibrary:gerenciar_acervo' %}">Gerenciar Acervo</a></li>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                
                <li><a href="#club">Clube do livro</a></li>
                <li><a href="#collections">ColeÃ§Ãµes</a></li>
                <li><a href="#support">Suporte</a></li>
                <li><a href="#settings">ConfiguraÃ§Ãµes</a></li>
            </ul>
        </nav>

        <a href="{% url 'virtuallibrary:logout' %}" class="logout">ðŸšª Log out</a>
    </aside>

    <main class="main-content fade-in">

        <h2 class="section-title">HistÃ³rico de EmprÃ©stimos</h2>

        <!-- Filtros -->
        <div class="filters">
            <a href="?f=todos" class="filter-btn {% if filtro == 'todos' %}active{% endif %}">
                Todos
            </a>
            <a href="?f=ativos" class="filter-btn {% if filtro == 'ativos' %}active{% endif %}">
                Ativos
            </a>
            <a href="?f=devolvidos" class="filter-btn {% if filtro == 'devolvidos' %}active{% endif %}">
                Devolvidos
            </a>
        </div>

        <div class="books-container">
            {% if emprestimos %}
                {% for emprestimo in emprestimos %}
                    <div class="book-card">
                        {% if emprestimo.book.cover %}
                            <img src="{{ emprestimo.book.cover.url }}" alt="{{ emprestimo.book.title }}" class="book-cover">
                        {% else %}
                            <div class="book-cover-placeholder">Sem capa</div>
                        {% endif %}

                        <div class="book-info">
                            <h3><a href="{% url 'virtuallibrary:book_detail' emprestimo.book.id %}">
                                {{ emprestimo.book.title }}
                            </a></h3>

                            <p class="book-author">{{ emprestimo.book.author }}</p>

                            <p>
                                <strong>Emprestado:</strong> 
                                {{ emprestimo.data_emprestimo|date:"d/m/Y H:i" }}
                            </p>

                            {% if emprestimo.status == "EM" %}
                                <p class="status active">ðŸ“˜ Ativo</p>
                                <p><strong>DevoluÃ§Ã£o prevista:</strong> - </p>
                                
                                <a class="return-btn" 
                                   href="{% url 'virtuallibrary:devolver_livro' emprestimo.id %}">
                                   ðŸ“¤ Devolver
                                </a>

                            {% else %}
                                <p class="status returned">ðŸ“— Devolvido</p>
                                <p>
                                    <strong>Devolvido em:</strong>
                                    {{ emprestimo.data_devolucao|date:"d/m/Y H:i" }}
                                </p>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p style="opacity: 0.7;">Nenhum registro encontrado.</p>
            {% endif %}
        </div>

        <!-- PaginaÃ§Ã£o -->
        <div class="pagination">
            {% if emprestimos.has_previous %}
                <a href="?page={{ emprestimos.previous_page_number }}&f={{ filtro }}">Â« Anterior</a>
            {% endif %}

            <span>PÃ¡gina {{ emprestimos.number }} de {{ emprestimos.paginator.num_pages }}</span>

            {% if emprestimos.has_next %}
                <a href="?page={{ emprestimos.next_page_number }}&f={{ filtro }}">PrÃ³xima Â»</a>
            {% endif %}
        </div>

    </main>
</body>
</html>
