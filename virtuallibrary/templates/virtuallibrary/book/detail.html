{% extends "virtuallibrary/base.html" %}
{% load static %}

{% block title %}My virtuallibrary{% endblock %}

{% block content %}
<h1>My virtuallibrary</h1>

<!-- FILTROS POR CATEGORIA/TAG - ADICIONAR ESTA SEÃ‡ÃƒO -->
<div class="category-filters" style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
    <h3>Filtrar por Categoria:</h3>
    
    <!-- BotÃ£o "Todos" -->
    <a href="{% url 'virtuallibrary:book_list' %}" 
       class="filter-btn {% if not tag %}active{% endif %}"
       style="display: inline-block; margin: 5px; padding: 8px 15px; text-decoration: none; background-color: {% if not tag %}#007bff{% else %}#6c757d{% endif %}; color: white; border-radius: 3px;">
        Todos
    </a>
    
    <!-- BotÃµes para cada tag -->
    {% for filter_tag in all_tags %}
        <a href="{% url 'virtuallibrary:book_list_by_tag' filter_tag.slug %}"
           class="filter-btn {% if tag.slug == filter_tag.slug %}active{% endif %}"
           style="display: inline-block; margin: 5px; padding: 8px 15px; text-decoration: none; background-color: {% if tag.slug == filter_tag.slug %}#007bff{% else %}#6c757d{% endif %}; color: white; border-radius: 3px;">
            {{ filter_tag.name }}
        </a>
    {% endfor %}
</div>

<!-- Indicador do filtro ativo -->
{% if tag %}
<h2 style="color: #007bff;">ðŸ“š Livros da categoria "{{ tag.name }}"</h2>
{% else %}
<h2>ðŸ“š Todos os livros</h2>
{% endif %}

<!-- FormulÃ¡rio de busca -->
<form method="get" action="{% url 'virtuallibrary:book_list' %}" style="margin: 20px 0;">
    {{ search_form.query }}
    <button type="submit" style="padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 3px;">Buscar</button>
</form>

<!-- Lista de livros -->
{% for book in books %}
    <div style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px;">
        {% if book.cover %}
            <img src="{{ book.cover.url }}" alt="{{ book.title }} cover" width="150" style="float: left; margin-right: 15px;">
        {% else %}
            <img src="{% static 'images/default_cover.png' %}" alt="Capa padrÃ£o" width="150" style="float: left; margin-right: 15px;">
        {% endif %}

        <h2>
            <a href="{% url 'virtuallibrary:book_detail' book.id %}" style="text-decoration: none; color: #007bff;">
                {{ book.title }}
            </a>
        </h2>

        <p class="tags" style="margin: 10px 0;">
            <strong>Tags:</strong> 
            {% for book_tag in book.tags.all %}
                <a href="{% url 'virtuallibrary:book_list_by_tag' book_tag.slug %}"
                   style="background-color: #e9ecef; padding: 3px 8px; margin: 2px; text-decoration: none; border-radius: 15px; font-size: 12px; color: #495057;">
                    {{ book_tag.name }}
                </a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </p>

        <!-- LINHA CORRIGIDA: Agora mostra o autor real e data real de publicaÃ§Ã£o -->
        <p class="date" style="color: #6c757d; font-size: 14px;">
            <strong>Autor:</strong> {{ book.author }} | 
            <strong>Publicado em:</strong> {{ book.publication_date|date:"d/m/Y" }}
        </p>
        
        <!-- InformaÃ§Ã£o opcional: quem adicionou ao sistema -->
        {% if user.is_staff %}
            <p style="color: #999; font-size: 12px;">
                <em>Adicionado ao sistema por {{ book.posted_by.username }} em {{ book.publish|date:"d/m/Y H:i" }}</em>
            </p>
        {% endif %}

        {{ book.body|truncatewords:30|linebreaks }}
        <div style="clear: both;"></div>
    </div>
{% endfor %}

{% include "pagination.html" with page=books %}
{% endblock %}
