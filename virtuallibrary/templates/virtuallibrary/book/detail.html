{% extends "virtuallibrary/base.html" %}
{% load static %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}

<!-- Mensagens de erro/sucesso -->
{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'error' %}
            <p style="color: red;">{{ message }}</p>
        {% endif %}
    {% endfor %}
{% endif %}

<h1>{{ book.title }}</h1>

{% if book.cover %}
    <img src="{{ book.cover.url }}" alt="{{ book.title }}" width="80" height="120" style="border-radius: 3px;">
{% else %}
    <div style="width: 80px; height: 120px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 3px; font-size: 12px; color: #666; text-align: center;">
        Sem capa
    </div>
{% endif %}

<p><strong>Autor:</strong> {{ book.author }}</p>
<p><strong>Publicado em:</strong> {{ book.publication_date|date:"d/m/Y" }}</p>

<p class="tags">
    <strong>Tags:</strong> 
    {% for tag in book.tags.all %}
        <a href="{% url 'virtuallibrary:book_list_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
</p>

<div>{{ book.body|linebreaks }}</div>

{% if user.is_authenticated %}
    <div style="margin: 20px 0;">
        <a href="{% url 'virtuallibrary:emprestar_livro' book.id %}" 
           style="background-color: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            ðŸ“š Emprestar este livro
        </a>
    </div>
{% endif %}

<h2>Livros similares</h2>
{% for similar_book in similar_books %}
    <div style="display: inline-block; margin: 10px; text-align: center; width: 150px;">
        <a href="{{ similar_book.get_absolute_url }}">
            {% if similar_book.cover %}
                <img src="{{ similar_book.cover.url }}" alt="{{ similar_book.title }}" width="120" height="180">
            {% else %}
                <img src="{% static 'images/default_cover.png' %}" alt="Capa padrÃ£o" width="120" height="180">
            {% endif %}
        </a>
        <p><a href="{{ similar_book.get_absolute_url }}">{{ similar_book.title }}</a></p>
    </div>
{% empty %}
    <p>NÃ£o hÃ¡ livros similares.</p>
{% endfor %}
{% endblock %}